{% load extras %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Calendário de Escala</title>
<style>
table {
  border-collapse: collapse;
  width: 100%;
}
th, td {
  border: 1px solid #ccc;
  padding: 4px;
  text-align: center;
  font-size: 12px;
}
thead {
  background: #f0f0f0;
}
select {
  font-size: 12px;
}
</style>
</head>
<body>

    <h1>Escala de {{ nome_mes }} de {{ ano }}</h1>

    <p><strong>Instituição:</strong> {{ instituicao }}</p>
    <p><strong>Residente:</strong> {{ residente }}</p>
    <p><strong>Setores:</strong>
        {% for setor in setores %}
            {{ setor.nome }}
        {% endfor %}
    </p>
    <p><strong>Preceptores:</strong>
        {% for preceptor in preceptores %}
            {{ preceptor.nome }}
        {% endfor %}
    </p>

<form method="post">
  {% csrf_token %}

  <table>
    <thead>
      <tr>
        <th>Turno</th>
        {% for dia in dias_do_mes %}
          <th>{{ dia.numero }}<br>{{ dia.nome }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for turno in turnos %}
      <tr>
        <td><strong>{{ turno|capfirst }}</strong></td>

        {% for dia in dias_do_mes %}
        <td>
          <select name="atividade_{{ dia.numero }}_{{ turno }}">
            <option value="">---</option>

            {% with chave=dia.numero|stringformat:"s"|add:"_"|add:turno %}
              {% for atividade in atividades %}
                <option value="{{ atividade.id }}"
                  {% if atividades_pre_selecionadas|get_item:chave == atividade.id|stringformat:"s" %}
                    selected
                  {% endif %}
                >
                  {{ atividade.sigla }}
                </option>
              {% endfor %}
            {% endwith %}
          </select>
        </td>
        {% endfor %}

      </tr>
      {% endfor %}
    </tbody>
  </table>

  <br>
  <button type="submit">Salvar Escala</button>
</form>

</body>
</html>